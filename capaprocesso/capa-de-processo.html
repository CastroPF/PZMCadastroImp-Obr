<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/capaprocesso/capa-de-processo.css" />
  <title>PZMWEB Enterprise :: Controle de Impostos</title>
</head>

<body>
  <header class="header-container">
    <div class="header-left">
      <h2>
        <a href="/consultas/operativo.html" class="mainmenu">
          PZMWEB Enterprise :: Controle de Impostos
        </a>
      </h2>
    </div>
    <div class="header-right">
      <img src="/grupopzm.png" alt="logo" class="logo" />
    </div>
  </header>

  <nav class="nav-container">
    <div class="nav-left">
      <div class="menu-item">
        Controles
        <div class="submenu">
          <a href="/modulos/index.html">Alterar Aplicativo</a>
          <a href="/modulos/divisão.html">Alterar Divisão</a>
        </div>
      </div>
      <span>Cadastros</span>
      <div class="menu-item">
        Operações
        <div class="submenu">
          <a href="/consultas/operativo.html">Checklist de Apurações de Impostos Operativo</a>
          <a href="/consultas/supervisor.html">Checklist de Apurações de Impostos Supervisor</a>
          <a href="/capaprocesso/capa-de-processo.html">Controle de Aprovação da Capa de Processo</a>
        </div>
      </div>
      <div class="submenu">
        <a href="/processos/calendario.html">Gerar Calendário de Vencimento de Impostos</a>
        <a href="/revisão/revisao.html">Gerar Checklist de Revisão</a>
        <a href="/GerarChecklist/checklist.html">Gerar Checklist de Apuração de Impostos</a>
        <a href="/ExclusaoChecklist/exclusao.html">Excluir Checklist de Apuração de Impostos</a>
        <a href="/revisão/revisao.html">Excluir Checklist de Revisão</a>
      </div>
      <div class="menu-item">
        Processos
        <div class="submenu">
          <a href="/calendario/calendario.html">Gerar Calendário de Vencimento de Impostos</a>
          <a href="/revisão/revisao.html">Gerar Checklist de Revisão</a>
          <a href="/GerarChecklist/checklist.html">Gerar Checklist de Apuração de Impostos</a>
          <a href="">Excluir Checklist de Apuração de Impostos</a>
          <a href="">Excluir Checklist de Revisão</a>
        </div>
      </div>
      <span>Relatórios</span>
      <span>Gráficos</span>
      <span>Configurações</span>
      <span>Ajuda</span>
      <span><a class="sair" href="/login/login.html">Sair</a></span>
    </div>
    <div class="nav-right">
      <div class="toggle-switch">
        <label class="switch-label">
          <input type="checkbox" class="checkbox" />
          <span class="slider"></span>
        </label>
      </div>
      <div class="flags">
        <img src="https://flagcdn.com/16x12/br.png" alt="Português" title="Português" />
        <img src="https://flagcdn.com/16x12/es.png" alt="Español" title="Español" />
        <img src="https://flagcdn.com/16x12/gb.png" alt="English" title="English" />
      </div>
    </div>
  </nav>

  <div class="form-header">
    <h3>Consulta Controle de Aprovação da Capa de Processo</h3>
  </div>

  <div class="painel-geral">
    <div class="card-filtros">
      <div class="linha-id-consulta" style="grid-column: 1 / -1; display: flex; align-items: flex-end; justify-content: space-between;">
        <div class="fitros-consulta" style="margin: 0;">
          <label>ID da Operação:</label>
          <div>
            <input type="text" placeholder="Digite o ID da operação" style="width: 380px;" />
          </div>
        </div>
        <button class="consulta">Consultar</button>
      </div>
      <div class="fitros-consulta">
        <label>Data Inicial:</label>
        <input type="date" value="2025-06-01" />
      </div>
      <div class="fitros-consulta">
        <label>Data Final:</label>
        <input type="date" value="2025-06-30" />
      </div>

      <div class="fitros-consulta">
        <label>Classificação:</label>
        <select>
          <option>Todos os itens</option>
        </select>
      </div>

      <div class="fitros-consulta">
        <label>Empresa:</label>
        <select>
          <option>Todos os itens</option>
        </select>
        <label><input type="checkbox" /> Filtrar Empresas Inativas</label>
      </div>
      <div class="fitros-consulta">
        <label>Estabelecimento:</label>
        <select>
          <option>Todos os itens</option>
        </select>
        <label><input type="checkbox" /> Filtrar Estabelecimentos Inativos</label>
      </div>

      <div class="fitros-consulta">
        <label>Imposto:</label>
        <select>
          <option>Todos os itens</option>
        </select>
      </div>

      <div class="fitros-consulta">
        <label>Esfera:</label>
        <select>
          <option>Todos os itens</option>
        </select>
      </div>

      <div class="fitros-consulta">
        <label>Responsável:</label>
        <select>
          <option>USUÁRIO PZM</option>
        </select>
      </div>

      <div class="fitros-consulta">
        <label>Status da Capa:</label>
        <select>
          <option>Todos os itens</option>
          <option>Pendente</option>
          <option>Agaurdando Aprovação - Conferente</option>
          <option>Agaurdando Aprovação - Supervisor</option>
        </select>
      </div>
    </div>

    <div class="card-grafico">
      <div class="grafico-item">
        <span class="titulo-grafico">Controle de Status</span>
        <canvas id="graficoFarol" width="300" height="260"></canvas>
      </div>
    </div>
  </div>

  <div class="linha-legenda-botoes">
    <div class="legenda">
      <span class="complementar">Complementar</span>
      <span class="retificacao">Retificação</span>
      <span class="dentro-prazo">Dentro do Prazo</span>
      <span class="no-limite">Prazo no Limite</span>
      <span class="vencido">Atenção: Prazo Vencido</span>
      <span class="finalizado">Processo Finalizado</span>
      <span class="fora-prazo">Finalizado [Fora do Prazo]</span>
      <span class="todos-os-status">Todos os Status</span>
    </div>
  </div>

  <div class="imp-info">
    <div class="linha-total-paginacao">
      <div class="totalizadores">
        <span>Total de Registros: 8</span>
        <span>Total de Itens: 16</span>
        <span><a href="#" class="baixar-anexos" onclick="abrirModal()">Total de Anexos: 14</a></span>
      </div>
      <nav class="pagination-nav">
        <label class="pagination-select">
          <span>Exibir</span>
          <select>
            <option>10</option>
            <option>20</option>
            <option>50</option>
            <option>100</option>
          </select>
          <span>por página</span>
        </label>
        <button class="pagination-btn" title="Primeira página">&laquo;</button>
        <button class="pagination-btn" title="Página anterior">&lsaquo;</button>
        <input type="number" value="1" min="1" class="pagination-input" />
        <span class="pagination-total">de 5</span>
        <button class="pagination-btn" title="Próxima página">&rsaquo;</button>
        <button class="pagination-btn" title="Última página">&raquo;</button>
      </nav>
    </div>
    <table>
      <thead>
        <tr class="header-table">
          <th></th>
          <th>Estabelecimento</th>
          <th>Número da operação</th>
          <th>Imposto</th>
          <th>Estágio</th>
          <th>Competência</th>
          <th>Data Prevista</th>
          <th>Data Realizada</th>
          <th>Valor Apurado</th>
          <th>Elaborador</th>
          <th>Conferente</th>
          <th>Supervisor</th>
          <th>Status</th>
          <th>Resultado de Operação</th>
          <th>Retificação</th>
          <th>Anexos</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="status-etapa">
              <input type="checkbox" name="checkbox1" id="checkbox1" /><span class="farol dentro-prazo" id="modalOpenButton"></span>
            </div>
          </td>
          <td><span>Grupo PZM Filial - SP</span></td>
          <td>12222</td>
          <td>ICMS</td>
          <td>Apuração</td>
          <td>06/2025</td>
          <td>15/07/2025</td>
          <td>15/07/2025</td>
          <td>250,00</td>
          <td>Igor Castro</td>
          <td>Igor Castro</td>
          <td>Igor Castro</td>
          <td>Pendente</td>
          <td>Devedora</td>
          <td>Original</td>
          <td>1</td>
        </tr>
        <tr>
          <td>
            <div class="status-etapa">
              <input type="checkbox" name="checkbox2" id="checkbox2" /><span class="farol finalizado" id="modalOpenButton"></span>
            </div>
          </td>
          <td><span>Grupo PZM Filial - SP</span></td>
          <td>12333</td>
          <td>ICMS</td>
          <td>Apuração</td>
          <td>06/2025</td>
          <td>15/07/2025</td>
          <td>15/07/2025</td>
          <td>250,00</td>
          <td>Igor Castro</td>
          <td>Igor Castro</td>
          <td>Igor Castro</td>
          <td>Concluído</td>
          <td>Devedora</td>
          <td>Original</td>
          <td>1</td>
        </tr>
      </tbody>
    </table>

    <div class="helpFab" id="helpFab">
      <span>?</span>
    </div>

    <div class="chat-popup" id="chat-popup">
      <div class="chat-header">
        <span>Agente PZM</span>
        <button class="close-chat" onclick="toggleChat()">×</button>
      </div>
      <div class="chat-body" id="chat-body">
        <div class="message bot">Olá! Como posso te ajudar hoje?</div>
      </div>
      <div class="chat-input-area">
        <input type="text" id="user-input" placeholder="Digite sua mensagem..." />
        <button onclick="sendMessage()">Enviar</button>
      </div>
    </div>

    <div id="modalAnexos" class="modal">
      <div class="modal-conteudo">
        <span class="fechar" onclick="fecharModal()">&times;</span>
        <h2>Anexos do Checklist</h2>

        <div class="tabela-anexos">
          <div class="cabecalho">
            <span><input type="checkbox" /></span>
            <span>ID</span>
            <span>Empresa</span>
            <span>Estabelecimento</span>
            <span>Imposto</span>
            <span>Ano e Mês</span>
            <span>Tamanho</span>
            <span>Arquivo</span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>22222</span>
            <span>ABC</span>
            <span>Matriz</span>
            <span>ICMS</span>
            <span>2025/07</span>
            <span>10GB</span>
            <span><a href="/anexos/anexo1.pdf" target="_blank">Comprovante.pdf</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>33333</span>
            <span>PZM</span>
            <span>Filial SP</span>
            <span>ISS</span>
            <span>2025/07</span>
            <span>3.4MB</span>
            <span><a href="/anexos/anexo2.jpg" target="_blank">Comprovante.jpg</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

          <div class="linha">
            <span><input type="checkbox" /></span>
            <span>44444</span>
            <span>XYZ</span>
            <span>Unidade RJ</span>
            <span>ICMS-ST</span>
            <span>2025/07</span>
            <span>790KB</span>
            <span><a href="/anexos/anexo3.xlsx" target="_blank">Planilha.xlsx</a></span>
          </div>

        </div>
        <button class="btn-download-todos">Baixar Todos</button>
      </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      function abrirModal() {
        document.getElementById("modalAnexos").style.display = "block";
      }

      function fecharModal() {
        document.getElementById("modalAnexos").style.display = "none";
      }

      // Fecha ao clicar fora
      window.onclick = function (event) {
        const modal = document.getElementById("modalAnexos");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const body = document.body;
        const darkToggle = document.querySelector(".checkbox");

        if (localStorage.getItem("dark-mode") === "enabled") {
          body.classList.add("dark-mode");
          if (darkToggle) darkToggle.checked = true;
        }

        if (darkToggle) {
          darkToggle.addEventListener("change", function () {
            if (darkToggle.checked) {
              body.classList.add("dark-mode");
              localStorage.setItem("dark-mode", "enabled");
            } else {
              body.classList.remove("dark-mode");
              localStorage.setItem("dark-mode", "disabled");
            }
            graficoFarol.update();
          });
        }

        const centerTextPlugin = {
          id: "centerText",
          afterDraw(chart) {
            const {
              ctx,
              chartArea: { left, top, width, height },
              data,
            } = chart;
            const total = data.datasets[0].data.reduce((sum, v) => sum + v, 0);
            const isDark = body.classList.contains("dark-mode");
            const x = left + width / 2;
            const y = top + height / 2;
            ctx.save();
            ctx.font = "bold 22px Arial";
            ctx.fillStyle = isDark ? "#fff" : "#000";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(total, x, y - 8);
            ctx.font = "12px Arial";
            ctx.fillStyle = isDark ? "#fff" : "#000";
            ctx.fillText("Total de tickets", x, y + 15);
            ctx.restore();
          },
        };

        const dataLabelPlugin = {
          id: "dataLabel",
          afterDatasetsDraw(chart) {
            const { ctx, data } = chart;
            const meta = chart.getDatasetMeta(0);
            meta.data.forEach((arc, i) => {
              const { x, y } = arc.getCenterPoint();
              const value = data.datasets[0].data[i];
              ctx.save();
              ctx.fillStyle = "#333";
              ctx.font = "bold 11px Arial";
              ctx.textAlign = "center";
              ctx.textBaseline = "middle";
              ctx.fillText(value, x, y);
              ctx.restore();
            });
          },
        };

        const shadowPlugin = {
          id: "shadow",
          beforeDraw(chart) {
            const ctx = chart.ctx;
            ctx.save();
            ctx.shadowColor = body.classList.contains("dark-mode")
              ? "#ffffff40"
              : "#b9b9b9";
            ctx.shadowBlur = 12;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
          },
          afterDraw(chart) {
            chart.ctx.restore();
          },
        };

        // Gráfico em ciculo
        const ctxFarol = document.getElementById("graficoFarol").getContext("2d");
        window.graficoFarol = new Chart(ctxFarol, {
          type: "doughnut",
          data: {
            labels: [
              " Complementar",
              " Retificação",
              " Dentro do Prazo",
              " Prazo no Limite",
              " Atenção: Prazo Vencido",
              " Processo Finalizado",
              " Finalizado [Fora do Prazo]"
            ],
            datasets: [{
              data: [1, 2, 5, 3, 1, 4, 1],
              backgroundColor: [
                "#002fff6b", "#f3007e", "#00e1ff", "orange", "red", "green", "purple"
              ],
              borderWidth: 3
            }]
          },
          options: {
            responsive: false,
            maintainAspectRatio: false,
            layout: { padding: 15 },
            elements: { arc: { hoverOffset: 15 } },
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label(ctx) {
                    const label = ctx.label || "";
                    const val = ctx.parsed;
                    const arr = ctx.chart.data.datasets[0].data;
                    const total = arr.reduce((s, v) => s + v, 0);
                    return `${label}: ${((val / total) * 100).toFixed(2)}%`;
                  }
                }
              }
            }
          },
          plugins: [shadowPlugin, centerTextPlugin, dataLabelPlugin],
        });
      });
    </script>
    <script src="/chatbot.js"></script>

</body>

</html>